---
import Layout from "../../layouts/Layout.astro"
import Post from "../../libs/buttercms"

export async function getStaticPaths() {
  const token = import.meta.env.BUTTER_TOKEN;
  let allPosts: Post[] = [];
  let page = 1;
  let totalPages = 1; // inizializziamo

  do {
    const res = await fetch(
      `https://api.buttercms.com/v2/posts/?auth_token=${token}&page=${page}&page_size=50`
    );
    const data = await res.json();

    const posts: Post[] = data.data || [];
    allPosts = allPosts.concat(posts);

    totalPages = data.meta?.total_pages || 1;
    page++;
  } while (page <= totalPages);

  // Mappa tutti i post in { params, props }
  return allPosts.map((post: Post) => ({
    params: {
      slug: post.slug,
    },
    props: { post },
  }));
}

const { post } = Astro.props;

---


<!-- Qui ricevi `post` come prop -->
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    
    <title>{post.title}</title>
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"
        integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+"
        crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet" />
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body);"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-css.min.js"></script>
        <!-- aggiungi i linguaggi che ti servono -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-c.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-kotlin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-clike.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-go.min.js"></script> 
        
  </head>
  <body>
    <Layout>
    <article>
        <div class="title_container">
            <img class="featured_image" src={post.featured_image} alt="">
            <h1>{post.title}</h1>
        
        </div>
            <p><em>{new Date(post.published).toLocaleDateString('it-IT')}</em></p>
            <div set:html={post.body}></div>
        </article>
    </Layout>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      Prism.highlightAll();
    });
  </script>
</html>

<style>

    @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap');

    .katex-version {display: none;}
    .katex-version::after {content:"0.10.2 or earlier";}

    h1 {
        font-size: 50px;
        /*text-align: left;*/
        text-decoration: underline;
    }
    
    article {
        font-family: "Roboto Mono";
        width: 100%;
        padding-top: 2%;
        padding-left: 2%;
        padding-right: 3%;
        text-align: justify;
        font-size: 16px;
    }
    .article_container {
        display: flex;
        flex-direction: row;
        justify-content: space-around;
    }
    
    article {
        line-height: 1.65;
        text-align: justify;
        overflow-x: scroll;
    }

    article pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
    }
    
    article code {
      font-family: "Roboto Mono", monospace;
      font-size: 0.95rem;
    }
    
    article pre, article code {
      text-align: left;      
      font-size: 0.9rem;     
    }
    
</style>
